{% extends 'admin/base.html.twig' %}

{% block content %}
<div class="page-header">
    <h2>GestiÃ³n de Usuarios</h2>
</div>

{# Search #}
<div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-bottom: 1.5rem;">
    <form method="get" style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: end;">
        <div class="form-group" style="margin-bottom: 0; flex: 1;">
            <label for="search">Buscar por nombre o email</label>
            <input type="text" name="search" id="search" placeholder="Buscar..." value="{{ currentSearch }}" style="padding: 0.5rem;">
        </div>
        
        <button type="submit" class="btn btn-primary">Buscar</button>
        <a href="{{ path('admin_users_list') }}" class="btn btn-secondary">Limpiar</a>
    </form>
</div>

{% if users|length > 0 %}
    <table>
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Email</th>
                <th>Roles</th>
                <th>Pedidos Completados</th>
                <th>Fecha de Registro</th>
                <th style="width: 100px;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>
                    <strong>{{ user.name }}</strong>
                </td>
                <td>
                    {{ user.email }}
                </td>
                <td>
                    {% for role in user.roles %}
                        {% if role == 'ROLE_ADMIN' %}
                            <span class="badge" style="background-color: #e74c3c;">Admin</span>
                        {% elseif role == 'ROLE_SELLER' %}
                            <span class="badge" style="background-color: #f39c12;">Vendedor</span>
                        {% elseif role == 'ROLE_CUSTOMER' %}
                            <span class="badge" style="background-color: #3498db;">Cliente</span>
                        {% else %}
                            <span class="badge" style="background-color: #95a5a6;">{{ role }}</span>
                        {% endif %}
                    {% endfor %}
                </td>
                <td>
                    {{ userStats[user.id].orderCount|default(0) }} pedido(s)
                </td>
                <td>
                    {{ user.createdAt|date('d/m/Y') }}
                </td>
                <td>
                    <a href="{{ path('admin_users_view', {id: user.id}) }}" class="btn btn-primary" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;">Ver</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <div class="empty-state">
        <div class="empty-state-icon">ðŸ‘¥</div>
        <h3>No hay usuarios</h3>
        <p>{% if currentSearch %}No se encontraron usuarios que coincidan con tu bÃºsqueda.{% else %}AÃºn no hay usuarios registrados.{% endif %}</p>
    </div>
{% endif %}
{% endblock %}
